---
title: 'Receiving Emails'
description: 'Receive incoming emails through webhooks'
---

A1Base can forward incoming emails to your application via webhooks. When an email is received at your A1Base email address, we'll send a POST request to your configured webhook URL with the email details.
You can configure your webhook on the [email dashboard here](https://www.a1base.com/dashboard/email-addresses)

‚è∞ Estimated setup time: 10min.
<Info>
### In this guide you will:

### 1. Setup a webhook endpoint in your app
- Create a simple endpoint to receive email webhooks
- Use ngrok to expose your local endpoint to the internet

### 2. Configure webhook URL in A1Mail dashboard
- Go to the [email dashboard](https://www.a1base.com/dashboard/email-addresses)
- Add your ngrok webhook URL to your A1Mail Dashboard

### 3. Test receiving emails
- Send a test email from your personal email address to your A1Mail inbox
- View the incoming email data in your webhook endpoint
- Parse and process the email contents as needed

</Info>

## 1. Create a Webhook Endpoint

First, create an endpoint in your application to receive email notifications. You can use one of our example snippets below or create your own.

<Card title="Webhook Implementation Examples" icon="webhook">
  <Tabs>
    <Tab title="Python (Flask)">
      ```python
      from flask import Flask, request, jsonify
      
      app = Flask(__name__)
      
      @app.route('/webhook/email', methods=['POST'])
      def email_webhook():
          # Get the webhook payload
          data = request.json        
          
          # Process the incoming email
          print(f"Received email: {data['subject']} from {data['sender_address']}")
          
          # Access specific parts of the email
          email_id = data.get('email_id')
          subject = data.get('subject')
          sender = data.get('sender_address')
          recipient = data.get('recipient_address')
          timestamp = data.get('timestamp')
          raw_email = data.get('raw_email_data')
          
          # Your logic here
          # ...
          
          # Return a success response
          return jsonify({"status": "success"}), 200
      
      if __name__ == '__main__':
          app.run(debug=True, port=5000)
      ```
    </Tab>
    <Tab title="Node.js (Express)">
      ```javascript
      const express = require('express');
      const app = express();
      
      app.use(express.json());
      
      app.post('/webhook/email', (req, res) => {
        // Get the webhook payload
        const data = req.body;      
        
        // Process the incoming email
        console.log(`Received email: ${data.subject} from ${data.sender_address}`);        
        
        // Access specific parts of the email
        const emailId = data.email_id;
        const subject = data.subject;
        const sender = data.sender_address;
        const recipient = data.recipient_address;
        const timestamp = data.timestamp;
        const rawEmail = data.raw_email_data;
        
        // Your logic here
        // ...
        
        // Return a success response
        res.status(200).json({ status: 'success' });
      });
      
      app.listen(3000, () => {
        console.log('Server listening on port 3000');
      });
      ```
    </Tab>
    <Tab title="JavaScript (Vanilla)">
      ```javascript
      // Simple vanilla JavaScript webhook handler
      // Can be used with any JavaScript framework or serverless function
      
      async function handleEmailWebhook(request) {
        try {
          // Parse the incoming JSON payload
          const data = await request.json();
          
          console.log(`Received email: ${data.subject} from ${data.sender_address}`);
          
          // Process email data
          const { 
            email_id, 
            subject, 
            sender_address, 
            recipient_address, 
            timestamp, 
            service,
            raw_email_data 
          } = data;
          
          // Your logic here
          // ...
          
          // Return a success response
          return new Response(JSON.stringify({ status: 'success' }), {
            status: 200,
            headers: { 'Content-Type': 'application/json' }
          });
        } catch (error) {
          console.error('Error processing webhook:', error);
          return new Response(JSON.stringify({ status: 'error', message: error.message }), {
            status: 500,
            headers: { 'Content-Type': 'application/json' }
          });
        }
      }
      ```
    </Tab>
  </Tabs>
</Card>

## 2. Expose Your Local Webhook Endpoint

To receive emails in your inbox, you need to expose your local webhook endpoint to the internet. You can use ngrok to do this.
Run the following command in your CLI to start ngrok:  
```bash  
ngrok http 3000
```
After starting ngrok

1. **Find the forwarding URL** in the ngrok output:
    ```
    Forwarding https://0fcbcda91e79.ngrok.app -> http://localhost:3000
    ```

2. **Create the full webhook URL** by appending your webhook endpoint path:
    ```
    https://0fcbcda91e79.ngrok.app/webhook/email
    ```

3. **Use this complete URL** in the A1Mail dashboard webhook settings.

## 3. Register Your Webhook in the Dashboard

Once you have your webhook URL, you need to register it in the A1Mail dashboard:

1. Log in to your [A1Base Dashboard](https://www.a1base.com/)
2. Navigate to the Email Settings section
3. Find your email address and click "Configure Webhook"
4. Enter your full webhook URL (e.g., `https://0fcbcda91e79.ngrok.app/webhook/email`)
5. Click "Save Changes"

## Webhook Precedence

When an email is received, A1Mail will attempt to deliver it to a webhook in the following order:

1. Individual email address webhook
2. Custom domain webhook
3. Default webhook

If a webhook is not configured or returns an error, A1Mail will try the next webhook in the precedence list.

![Individual Email Webhook](https://public-a1base-agent-images.s3.us-east-1.amazonaws.com/a1send-webhook.png)

![Custom Domain Webhook](https://public-a1base-agent-images.s3.us-east-1.amazonaws.com/custom-mail-domain-webhook.png)

## 4. Test Your Webhook

Send a test email to your inbox and check if the webhook is receiving the email notifications.

## Webhook Payload

When an email is received, A1Base will send a POST request to your webhook endpoint with the following JSON payload:

```json
{
    "email_id": "a82b3e6b-dc79-46ad-9284-a166629592e3",
    "subject": "Email Subject",
    "sender_address": "sender@example.com",
    "recipient_address": "your-address@a1send.com",
    "timestamp": "2025-03-19T10:24:08.46083+00:00",
    "service": "email",
    "raw_email_data": "Full email content including headers and body"
}
```

### Payload Fields

| Field | Type | Description |
|-------|------|-----------|
| `email_id` | string | Unique identifier for the received email |
| `subject` | string | Subject line of the email |
| `sender_address` | string | Email address of the sender |
| `recipient_address` | string | Your A1Base email address that received the message |
| `timestamp` | string | ISO 8601 timestamp of when the email was received |
| `service` | string | Always "email" for email webhooks |
| `raw_email_data` | string | Complete raw email content including headers and body |

## Webhook Security

To ensure the security and authenticity of webhook requests, A1Base includes security headers with each webhook POST request:

### Security Headers

| Header | Description |
|--------|-------------|
| `x-signature` | HMAC-SHA256 signature to verify request authenticity |
| `x-timestamp` | Unix timestamp used in the signature, helps prevent replay attacks |

### Signature Verification

The signature is generated using:
```
HMAC_SHA256(secret, timestamp + raw JSON body)
```

Here's how to verify webhook signatures in your application:

<Card title="Signature Verification Examples" icon="shield-check">
  <Tabs>
    <Tab title="Python (Flask)">
      ```python
      import hmac
      import hashlib
      from flask import Flask, request, jsonify
      
      app = Flask(__name__)
      
      @app.route('/webhook/email', methods=['POST'])
      def email_webhook():
          # Get the webhook headers and raw body
          signature = request.headers.get('x-signature')
          timestamp = request.headers.get('x-timestamp')
          raw_body = request.get_data()
          
          # Your webhook secret from A1Base dashboard
          secret = 'your_webhook_secret'
          
          # Create the expected signature
          message = timestamp + raw_body.decode()
          expected_signature = hmac.new(
              secret.encode(),
              message.encode(),
              hashlib.sha256
          ).hexdigest()
          
          # Compare signatures using a secure constant-time comparison
          if not hmac.compare_digest(signature, expected_signature):
              return jsonify({'error': 'Invalid signature'}), 403
              
          # Process the verified webhook
          data = request.json
          print(f"Received verified email: {data['subject']}")
          
          return jsonify({'status': 'success'}), 200
      ```
    </Tab>
    <Tab title="Node.js (Express)">
      ```javascript
      const crypto = require('crypto');
      const express = require('express');
      const app = express();
      
      // Capture raw body for signature verification
      app.use(express.json({
        verify: (req, res, buf) => {
          req.rawBody = buf;
        }
      }));
      
      app.post('/webhook/email', (req, res) => {
        const signature = req.headers['x-signature'];
        const timestamp = req.headers['x-timestamp'];
        const rawBody = req.rawBody.toString();
        const secret = process.env.A1BASE_WEBHOOK_SECRET;
        
        // Create expected signature
        const expectedSignature = crypto
          .createHmac('sha256', secret)
          .update(timestamp + rawBody)
          .digest('hex');
        
        // Compare signatures
        if (signature !== expectedSignature) {
          return res.status(403).send('Invalid signature');
        }
        
        // Process verified webhook
        const data = req.body;
        console.log(`Received verified email: ${data.subject}`);
        
        res.status(200).json({ status: 'success' });
      });
      ```
    </Tab>
  </Tabs>
</Card>

### Security Best Practices

1. **Always verify signatures** to ensure requests are from A1Base
2. **Check timestamp age** to prevent replay attacks (reject requests older than 5 minutes)
3. **Use environment variables** to store your webhook secret
4. **Implement proper error handling** for invalid signatures
5. **Use HTTPS endpoints** in production
6. **Keep your webhook URL and secret private**

## Example Raw Email Data

The `raw_email_data` field contains the complete email including headers, which you can parse to extract additional information like:

- DKIM signatures
- Message ID
- Content type
- Email body (plain text and HTML versions)
- Custom headers 

<Info type="info" emoji="üí°">
  <b>We'd love to hear from you!</b>
  
  Don't hesitate to reach out to <a href="mailto:pennie@a1base.com">pennie@a1base.com</a> or <a href="mailto:pasha@a1base.com">pasha@a1base.com</a> if there's any features you'd like to see or prioritised!
</Info>
